var de=Object.defineProperty;var ue=(s,t,e)=>t in s?de(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var u=(s,t,e)=>(ue(s,typeof t!="symbol"?t+"":t,e),e),K=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var h=(s,t,e)=>(K(s,t,"read from private field"),e?e.call(s):t.get(s)),m=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},y=(s,t,e,i)=>(K(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);var v=(s,t,e)=>(K(s,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();const ye={width:40,height:30},H=20;var f=(s=>(s[s.up=0]="up",s[s.right=1]="right",s[s.down=2]="down",s[s.left=3]="left",s))(f||{}),g=(s=>(s[s.top=0]="top",s[s.right=1]="right",s[s.bottom=2]="bottom",s[s.left=3]="left",s))(g||{}),d=(s=>(s[s.finished=0]="finished",s[s.playing=1]="playing",s[s.paused=2]="paused",s))(d||{}),S,p,M,te,D,ie,F,se,B,ne;const N=class{constructor(t,e){m(this,M);m(this,D);m(this,F);m(this,B);u(this,"root");u(this,"width");u(this,"height");u(this,"snakeSize");u(this,"snakeColor","#333");u(this,"foodColor","#f40");m(this,S,null);m(this,p,null);const i=typeof t=="string"?document.querySelector(t):t;if(!i||!("innerHTML"in i))throw new TypeError(`'el' expect a selector or a HTMLElement, but got a '${t}'`);this.root=i,this.width=e.width,this.height=e.height,this.snakeSize=e.snakeSize,e.snakeColor&&(this.snakeColor=e.snakeColor),e.foodColor&&(this.foodColor=e.foodColor),this.init()}init(){(!h(this,S)||!h(this,p))&&this.createCanvas()}createCanvas(){const t=document.createElement("canvas"),e=t.getContext("2d");t.classList.add("greedy-snake-canvas"),t.width=this.width,t.height=this.height,y(this,S,t),y(this,p,e),this.root.appendChild(t)}draw(t,e){if(!h(this,p))return;this.clear(),this.drawLine();const n=t.find(a=>a.part==="HEAD"),o=t.filter(a=>a.part==="BODY"),r=t.find(a=>a.part==="TAIL");n&&o.length>0&&r&&(v(this,M,te).call(this,n,N.getOrientation(n,o[0])),v(this,D,ie).call(this,o),v(this,F,se).call(this,r,N.getOrientation(r,o.at(-1)))),e&&v(this,B,ne).call(this,e)}drawLine(){const t=h(this,p);if(!t)return;const{width:e,height:i,snakeSize:n}=this,o=e/n,r=i/n;for(let a=0;a<o;a++)t.beginPath(),t.strokeStyle="#f1f1f1",t.moveTo(a*n,0),t.lineTo(a*n,i),t.stroke(),t.closePath();for(let a=0;a<r;a++)t.beginPath(),t.strokeStyle="#f1f1f1",t.moveTo(0,a*n),t.lineTo(e,a*n),t.stroke(),t.closePath()}clear(){const{width:t,height:e}=this,i=h(this,p);!i||i.clearRect(0,0,t,e)}destroy(){h(this,S)&&this.root.removeChild(h(this,S))}static getOrientation({x:t,y:e},{x:i,y:n}){return t===i?e>n?g.bottom:g.top:e===n?t>i?g.right:g.left:g.right}};let Y=N;S=new WeakMap,p=new WeakMap,M=new WeakSet,te=function(t,e){const i=h(this,p);if(!i)return;const{x:n,y:o}=t,{snakeSize:r,snakeColor:a}=this;i.save(),i.translate(n*r,o*r),i.strokeStyle=a,i.strokeRect(2,2,r-4,r-4);let c,x;switch(e){case g.top:c={x:7,y:7},x={x:r-7,y:7};break;case g.bottom:c={x:7,y:r-7},x={x:r-7,y:r-7};break;case g.left:c={x:7,y:7},x={x:7,y:r-7};break;case g.right:c={x:r-7,y:7},x={x:r-7,y:r-7};break}i.fillStyle=a,i.beginPath(),i.arc(c.x,c.y,2,0,2*Math.PI),i.arc(x.x,x.y,2,0,2*Math.PI),i.fill(),i.restore()},D=new WeakSet,ie=function(t){const e=h(this,p);if(!e)return;const{snakeSize:i,snakeColor:n}=this;t.forEach(o=>{e.save(),e.translate(o.x*i,o.y*i),e.strokeStyle=n,e.strokeRect(2,2,i-4,i-4),e.fillStyle=n,e.fillRect(4,4,i-8,i-8),e.restore()})},F=new WeakSet,se=function(t,e){const i=h(this,p);if(!i)return;const{snakeSize:n,snakeColor:o}=this;i.save(),i.translate(t.x*n,t.y*n),i.strokeStyle=o,i.strokeRect(2,2,n-4,n-4);let r,a,c;switch(e){case g.top:r={x:n/2,y:4},a={x:4,y:n-4},c={x:n-4,y:n-4};break;case g.bottom:r={x:n/2,y:n-4},a={x:4,y:4},c={x:n-4,y:4};break;case g.left:r={x:4,y:n/2},a={x:n-4,y:4},c={x:n-4,y:n-4};break;case g.right:r={x:n-4,y:n/2},a={x:4,y:4},c={x:4,y:n-4};break}i.fillStyle=o,i.beginPath(),i.moveTo(r.x,r.y),i.lineTo(a.x,a.y),i.lineTo(c.x,c.y),i.closePath(),i.fill(),i.restore()},B=new WeakSet,ne=function(t){const e=h(this,p);if(!e)return;const{snakeSize:i,foodColor:n}=this;e.save(),e.translate(t.x*i,t.y*i),e.beginPath(),e.strokeStyle=n,e.arc(i/2,i/2,i/2-2,0,2*Math.PI),e.stroke(),e.closePath(),e.beginPath(),e.arc(i/2,i/2,i/2-4,0,2*Math.PI),e.fillStyle=n,e.fill(),e.closePath(),e.restore()};const $="GAME_OVER",re="PAUSED",ae="PLAYING",U=class{constructor(){u(this,"_maxListeners");u(this,"_events");this._events=Object.create(null)}get events(){return this._events}get eventNames(){return Object.keys(this._events)}get maxListener(){return this._maxListeners?this._maxListeners:U.defaultMaxListener}set maxListener(t){this._maxListeners=t}on(t,e){this._events[t]?this._events[t].length>=this.maxListener?console.warn("\u76D1\u542C\u7684\u4E8B\u4EF6\u4E0D\u80FD\u8D85\u8FC7\u8BBE\u7F6E\u7684\u6700\u5927\u76D1\u542C\u6570\u3002"):this._events[t].push(e):this._events[t]=[e]}once(t,e){const i=(...n)=>{e(...n),this.off(t,i)};i.listen=e,this.on(t,i)}emit(t,...e){this._events[t]&&this._events[t].forEach(i=>{i.call(this,...e)})}off(t,e){this._events[t]&&(this._events[t]=this._events[t].filter(i=>e!==i&&e!==i.listen))}clear(){this._events=Object.create(null)}};let _=U;u(_,"defaultMaxListener",10);const Q=(s,t)=>Math.round(Math.random()*(t-s))+s;var I=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},oe="Expected a function",Z=0/0,ge="[object Symbol]",ke=/^\s+|\s+$/g,xe=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,pe=/^0o[0-7]+$/i,be=parseInt,we=typeof I=="object"&&I&&I.Object===Object&&I,ve=typeof self=="object"&&self&&self.Object===Object&&self,Se=we||ve||Function("return this")(),Te=Object.prototype,Le=Te.toString,Ee=Math.max,Ce=Math.min,W=function(){return Se.Date.now()};function Ae(s,t,e){var i,n,o,r,a,c,x=0,J=!1,E=!1,R=!0;if(typeof s!="function")throw new TypeError(oe);t=ee(t)||0,j(e)&&(J=!!e.leading,E="maxWait"in e,o=E?Ee(ee(e.maxWait)||0,t):o,R="trailing"in e?!!e.trailing:R);function q(l){var w=i,C=n;return i=n=void 0,x=l,r=s.apply(C,w),r}function he(l){return x=l,a=setTimeout(P,t),J?q(l):r}function ce(l){var w=l-c,C=l-x,X=t-w;return E?Ce(X,o-C):X}function V(l){var w=l-c,C=l-x;return c===void 0||w>=t||w<0||E&&C>=o}function P(){var l=W();if(V(l))return G(l);a=setTimeout(P,ce(l))}function G(l){return a=void 0,R&&i?q(l):(i=n=void 0,r)}function le(){a!==void 0&&clearTimeout(a),x=0,i=c=n=a=void 0}function fe(){return a===void 0?r:G(W())}function z(){var l=W(),w=V(l);if(i=arguments,n=this,c=l,w){if(a===void 0)return he(c);if(E)return a=setTimeout(P,t),q(c)}return a===void 0&&(a=setTimeout(P,t)),r}return z.cancel=le,z.flush=fe,z}function Pe(s,t,e){var i=!0,n=!0;if(typeof s!="function")throw new TypeError(oe);return j(e)&&(i="leading"in e?!!e.leading:i,n="trailing"in e?!!e.trailing:n),Ae(s,t,{leading:i,maxWait:t,trailing:n})}function j(s){var t=typeof s;return!!s&&(t=="object"||t=="function")}function Ie(s){return!!s&&typeof s=="object"}function _e(s){return typeof s=="symbol"||Ie(s)&&Le.call(s)==ge}function ee(s){if(typeof s=="number")return s;if(_e(s))return Z;if(j(s)){var t=typeof s.valueOf=="function"?s.valueOf():s;s=j(t)?t+"":t}if(typeof s!="string")return s===0?s:+s;s=s.replace(ke,"");var e=me.test(s);return e||pe.test(s)?be(s.slice(2),e?2:8):xe.test(s)?Z:+s}var Oe=Pe,A,T,k,b,L,O;class je extends _{constructor(e,i,n){super();m(this,L);u(this,"canvas");u(this,"width");u(this,"height");u(this,"speed",100);m(this,A,[]);m(this,T,{x:0,y:0});m(this,k,f.right);m(this,b,d.finished);u(this,"requestId",0);u(this,"startTime",0);this.canvas=e,this.width=i,this.height=n,this.init(),this.initEvent()}get snake(){return h(this,A)}set snake(e){y(this,A,e)}init(){this.snake=[{part:"HEAD",x:2,y:0},{part:"BODY",x:1,y:0},{part:"TAIL",x:0,y:0}],y(this,T,v(this,L,O).call(this)),y(this,k,f.right),y(this,b,d.playing),this.startTime=Date.now(),this.run()}initEvent(){this.handleKeyDown=Oe(this.handleKeyDown.bind(this),this.speed),document.addEventListener("keydown",this.handleKeyDown,!1)}destroy(){this.snake=[],y(this,b,d.finished),document.removeEventListener("keydown",this.handleKeyDown,!1)}run(){if(h(this,b)!==d.playing){cancelAnimationFrame(this.requestId);return}const e=Date.now();e-this.startTime>=this.speed&&(this.getNextFrame(),this.startTime=e),this.canvas.draw(this.snake,h(this,T)),this.requestId=requestAnimationFrame(this.run.bind(this))}setStatus(e,i){switch(y(this,b,e),e){case d.finished:this.emit($,this.snake.length);return;case d.paused:this.emit(re);break;case d.playing:this.emit(ae);break}i===d.paused&&e===d.playing&&this.run()}play(){this.setStatus(d.playing,d.paused)}getNextFrame(){const e=h(this,T),{width:i,height:n}=this,o=this.snake[0],r={...o};switch(h(this,k)){case f.up:r.y-=1;break;case f.right:r.x+=1;break;case f.down:r.y+=1;break;case f.left:r.x-=1;break}if(r.x<0||r.x>=i||r.y<0||r.y>=n)switch(h(this,k)){case f.left:r.x=i-1;break;case f.right:r.x=0;break;case f.up:r.y=n-1;break;case f.down:r.y=0;break}if(this.snake.some(a=>a.x===r.x&&a.y===r.y)){this.setStatus(d.finished,d.playing);return}if(r.x===e.x&&r.y===e.y){o.part="BODY",this.snake.unshift(r),y(this,T,v(this,L,O).call(this));return}o.part="BODY",this.snake.pop(),this.snake.unshift(r),this.snake.at(-1).part="TAIL"}handleKeyDown(e){switch(e.code){case"ArrowUp":case"KeyW":h(this,k)!==f.down&&y(this,k,f.up);break;case"ArrowRight":case"KeyD":h(this,k)!==f.left&&y(this,k,f.right);break;case"ArrowDown":case"KeyS":h(this,k)!==f.up&&y(this,k,f.down);break;case"ArrowLeft":case"KeyA":h(this,k)!==f.right&&y(this,k,f.left);break;case"Space":if(h(this,b)===d.finished)return;this.setStatus(h(this,b)===d.paused?d.playing:d.paused,h(this,b));break}}}A=new WeakMap,T=new WeakMap,k=new WeakMap,b=new WeakMap,L=new WeakSet,O=function(){const e=this.snake,{width:i,height:n}=this,o=Q(0,i-1),r=Q(0,n-1);return this.snake.length>=i*n?(this.emit($,this.snake.length),{x:0,y:0}):e.some(a=>a.x===o&&a.y===r)?v(this,L,O).call(this):{x:o,y:r}};window.addEventListener("DOMContentLoaded",()=>{const{width:s,height:t}=ye,e=new Y("#app",{width:s*H,height:t*H,snakeSize:H}),i=new je(e,s,t),n=document.querySelector("#J_finished"),o=document.querySelector("#J_paused");i.on($,r=>{if(n){n.style.display="block";const a=n.querySelector("#J_length"),c=n.querySelector(".btn-again");a&&(a.textContent=`${r}`),c&&(c.onclick=()=>{i.init(),n.style.display="none"})}}),i.on(re,()=>{if(o){o.style.display="block";const r=o.querySelector(".btn-play");r&&(r.onclick=()=>{o.style.display="none",i.play()})}}),i.on(ae,()=>{o&&(o.style.display="none")})});
